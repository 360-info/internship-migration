replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=45))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=60))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=10))
?replace_str
??replace_str
?str_replace
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=45))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
str_replace("Forced labour; Sexual exploitation;Combined sexual and labour exploitation",
"Combined sexual and labour exploitation") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
str_replace(typeOfExploitConcatenated,
"Forced labour; Sexual exploitation;Combined sexual and labour exploitation",
"Combined sexual and labour exploitation") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
str_replace(typeOfExploitConcatenated,
"`Forced labour; Sexual exploitation;Combined sexual and labour exploitation`",
"`Combined sexual and labour exploitation`") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
str_replace(typeOfExploitConcatenated,
fixed("Forced labour; Sexual exploitation;Combined sexual and labour exploitation"),
"Combined sexual and labour exploitation") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
str_replace(typeOfExploitConcatenated,
fixed("Forced labour; Sexual exploitation;Combined sexual and labour exploitation"),
fixed("Combined sexual and labour exploitation")) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
?gsub
??gsub
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
gsub("Forced labour; Sexual exploitation;Combined sexual and labour exploitation", "Combined sexual and labour exploitation", typeOfExploitConcatenated, fixed = TRUE) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
gsub("Forced labour; Sexual exploitation;Combined sexual and labour exploitation", "Combined sexual and labour exploitation", ct$typeOfExploitConcatenated, fixed = TRUE) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct
ct$typeOfExploitConcatenated
ct$typeOfExploitConcatenated[df$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
?filter
?dplyr::filter
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
dplyr::filter(typeOfexploitConcatenated == !"Forced labour;Other") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
dplyr::filter(typeOfExploitConcatenated == !"Forced labour;Other") %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ct %>%
replace_na(list(typeOfExploitConcatenated = 'unknown')) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=20))
install.packages("renv")
renv::restore()
knitr::opts_chunk$set(echo = TRUE)
install.packages(c("knitr", "tidyverse", "naniar", "gganimate"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(naniar)
library(gganimate)
ct <- read_csv("data/The Global Dataset 14 Apr 2020.csv")
ct <- ct %>%
select(-1) %>% # deselect unused column
na_if(-99)     # replace all -99 values with NA as defined in the codebook
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctp1 <- ct %>%
drop_na(typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip()
ctp1
# `Forced labour;Other` & NA not required?
ctp1 +
facet_wrap(~majorityStatus)
# should we include NA?
#ctcountries stands for citizenship countries
ctcountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
mutate(citizenship = `Alpha-2 code`) %>%
distinct(`Alpha-2 code`, .keep_all = TRUE)
#excountries stands for countries the victim are exploitted to
excountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
mutate(CountryOfExploitation = `Alpha-2 code`) %>%
distinct(`Alpha-2 code`, .keep_all = TRUE)
# match the citizenship country code with country names and coordinates
ct1 <- ct %>%
select(yearOfRegistration,
gender,
citizenship,
typeOfExploitConcatenated,
CountryOfExploitation) %>%
drop_na(CountryOfExploitation)
ct1
ct1a <- left_join(ct1, ctcountries)
ct1a <- ct1a %>%
mutate(CountryFrom = Country,
LatitudeFrom = `Latitude (average)`,
LongitudeFrom = `Longitude (average)`)
ct1a <- ct1a %>%
select(citizenship,
CountryFrom,
LatitudeFrom,
LongitudeFrom,
yearOfRegistration,
gender,
typeOfExploitConcatenated,
CountryOfExploitation)
# match the country of exploitation code with country names and coordinates
ct1b <- left_join(ct1a, excountries)
ct1b <- ct1b %>%
mutate(CountryOfExploitted = Country,
LatitudeOfExploitation = `Latitude (average)`,
LongitudeOfExploitation = `Longitude (average)`)
ct1b <- ct1b %>%
select(citizenship,
CountryFrom,
LatitudeFrom,
LongitudeFrom,
yearOfRegistration,
gender,
typeOfExploitConcatenated,
CountryOfExploitation,
CountryOfExploitted,
LatitudeOfExploitation,
LongitudeOfExploitation
)
ctp1a <- ct %>%
drop_na(typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ctp1a
ctp1a <- ct %>%
drop_na(majorityStatus) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ctp1a
ctp1a <- ct %>%
drop_na(majorityStatus) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
facet_wrap(~majorityStatus)
ctp1a
ctp1a <- ct %>%
drop_na(majorityStatus) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ctp1a
ctp1a <- ct %>%
drop_na(c(majorityStatus, typeOfExploitConcatenated)) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ctp1a
install.packages("plotly")
library(plotly)
ctp1a <- ct %>%
drop_na(c(majorityStatus, typeOfExploitConcatenated)) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ct %>%
drop_na(typeOfExploitConcatenated)
ct %>%
select(gender, typeOfExploitConcatenated, majorityStatus) %>%
drop_na(typeOfExploitConcatenated, majorityStatus)
ct %>%
drop_na(c(majorityStatus, typeOfExploitConcatenated))
ct %>%
select(gender, typeOfExploitConcatenated, majorityStatus) %>%
drop_na(typeOfExploitConcatenated, majorityStatus) %>%
count(typeOfExploitConcatenated = factor(typeOfExploitConcatenated),
majorityStatus = factor(majorityStatus)) %>%
mutate(pct = prop.table(n))
ct %>%
select(gender, typeOfExploitConcatenated, majorityStatus) %>%
drop_na(typeOfExploitConcatenated, majorityStatus) %>%
count(typeOfExploitConcatenated = factor(typeOfExploitConcatenated),
majorityStatus = factor(majorityStatus)) %>%
mutate(pct = prop.table(n)) %>%
ggplot(aes(x = typeOfExploitConcatenated, y = pct, fill = majorityStatus,
label = scales::percent(pct))) +
geom_col(position = "dodge") +
scale_y_continuous(labels = scales::percent)
ctp1
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.x = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctp1 <- ct %>%
drop_na(typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip()
ctp1
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme(axis.text.y = element_text(angle=15)) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip() +
theme(axis.text.y = element_text(angle=15)) +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip() +
theme(axis.text.y = element_text(angle=45)) +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_line() +
theme_bw() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
ctp1a <- ct %>%
drop_na(majorityStatus, typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip() +
facet_wrap(~majorityStatus)
ggplotly(ctp1a)
View(ct)
ct %>%
select(gender, typeOfExploitConcatenated, majorityStatus)
View(ct1)
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated, majorityStatus)
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated, majorityStatus) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated)
ctEX
ctEx
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated)
ctEx
ctp1 <- ct %>%
drop_na(typeOfExploitConcatenated) %>%
ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
geom_bar(position = "dodge", width = .7) +
theme_bw() +
coord_flip()
ctp1
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
mutate(pct = prop.table(n))
ctEx
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated,gender)
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
summarise(typeOfExploitConcatenated = n()) %>%
mutate(freq = round(typeOfExploitConcatenated/sum(typeOfExploitConcatenated), 4))
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(typeOfExploitConcatenated) %>%
summarise(gender = n()) %>%
mutate(freq = round(gender/sum(gender), 4))
ctEx
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
ungroup()
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
ungroup() %>%
group_by(gender, typeOfExploitConcatenated) %>%
mutate(percent = n/sum(n))
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
ungroup() %>%
group_by(typeOfExploitConcatenated, gender) %>%
mutate(percent = n/sum(n))
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
ungroup()
ctEx%>%
group_by(typeOfExploitConcatenated, gender) %>%
mutate(percent = n/sum(n))
ctEx
ctEx %>%
group_by(typeOfExploitConcatenated, gender) %>%
mutate(percent = n/sum(n))
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender) %>%
count(typeOfExploitConcatenated) %>%
ungroup()
ctEx
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
group_by(gender, typeOfExploitConcatenated) %>%
count(typeOfExploitConcatenated) %>%
ungroup()
ctEx %>%
group_by(typeOfExploitConcatenated, gender) %>%
mutate(percent = prop.table(n))
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated)
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
mutate(percent = n/sum(n) * 100)
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
mutate(percent = round(n/sum(n) * 100),2)
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
mutate(percent = round((n/sum(n) * 100),2))
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(typeOfExploitConcatenated, gender) %>%
mutate(percent = round((n/sum(n) * 100),2))
ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
mutate(percent = round((n/sum(n) * 100),2))
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
mutate(percent = round((n/sum(n) * 100),2))
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
group_by(gender,typeOfExploitConcatenated) %>%
mutate(percent = round((n/sum(n) * 100),2))
ctEx
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
group_by(gender) %>%
mutate(percent = round((n/sum(n) * 100),2))
ctEx
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
"Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"
ctEx <- ct %>%  # dataset for type of exploits
select(gender, typeOfExploitConcatenated) %>%
drop_na(typeOfExploitConcatenated) %>%
count(gender, typeOfExploitConcatenated) %>%
group_by(typeOfExploitConcatenated) %>%
mutate(percent = round((n/sum(n) * 100),2))
ctEx
