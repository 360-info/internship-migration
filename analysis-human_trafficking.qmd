---
title: "analysis - human trafficking"
author: "Ruimin Lin - 28757599"
code-fold: true
theme: style/article.scss
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(naniar)
library(gganimate)
library(plotly)
```

-   The human trafficking data is obtained from [Counter Trafficking Data Collaborative](https://www.ctdatacollaborative.org/dataset/resource/511adcb7-b1a2-4cc7-bf2f-0960d43a49cc).
-   The coordinate data for countries is obtained from [Tadas Tamo≈°auskas](https://gist.github.com/tadast/8827699).

```{r}
ct <- read_csv("data/The Global Dataset 14 Apr 2020.csv")


ct <- ct %>%
  select(-1) %>% # deselect unused column
  na_if(-99)     # replace all -99 values with NA as defined in the codebook

```

```{r}
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
                               "Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Sexual and labour exploitation"

```

### Features of the victim Plot v1 

```{r}
ctp1 <- ct %>%
  drop_na(typeOfExploitConcatenated) %>%
  ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
  geom_bar(position = "dodge", width = .7) +
  theme_bw() +
  coord_flip()

ctp1

```


### Features of the victim Plot v2

```{r}

ctp1a <- ct %>%
  drop_na(majorityStatus, typeOfExploitConcatenated) %>%
  ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
  geom_bar(position = "dodge", width = .7) +
  theme_bw() +
  coord_flip() +
  facet_wrap(~majorityStatus)

ggplotly(ctp1a)
```

### Features of the victim Plot v3

```{r}

ctEx <- ct %>%  # dataset for type of exploits
  select(gender, typeOfExploitConcatenated) %>%
  drop_na(typeOfExploitConcatenated) %>%
  count(gender, typeOfExploitConcatenated) %>%
  group_by(typeOfExploitConcatenated) %>%
  mutate(pct = round((n/sum(n)),4)) %>%
  arrange(desc(n)) %>%
  head(10)

ctEx
```

```{r}
ctp1b <- ctEx %>%
  mutate(Label = paste0(round(pct*100,2), "%")) %>%
  ggplot(aes(x = typeOfExploitConcatenated, y = n,
             fill = gender)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = Label),
            position = position_dodge(width = 0.9),
            size = 3) +
  theme_bw()


ctp1b +
  coord_flip()
```


```{r}
ctEx %>%
  ggplot(aes(x = typeOfExploitConcatenated, y = n,
             fill = gender, label = scales::percent(pct))) +
  geom_col(position = "dodge") +
  geom_text(position = position_dodge(width = 0.9),
            size = 3) +
  theme_bw() +
  scale_y_continuous(labels = scales::percent)
```



```{r}
#ctcountries stands for citizenship countries
ctcountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
  mutate(citizenship = `Alpha-2 code`) %>%
  distinct(`Alpha-2 code`, .keep_all = TRUE)

#excountries stands for countries the victim are exploitted to 
excountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
  mutate(CountryOfExploitation = `Alpha-2 code`) %>%
  distinct(`Alpha-2 code`, .keep_all = TRUE)

```

```{r}
# match the citizenship country code with country names and coordinates
ct1 <- ct %>%
  select(yearOfRegistration,
         gender,
         citizenship,
         typeOfExploitConcatenated,
         CountryOfExploitation) %>%
  drop_na(CountryOfExploitation)
ct1

ct1a <- left_join(ct1, ctcountries)

ct1a <- ct1a %>%
  mutate(CountryFrom = Country,
         LatitudeFrom = `Latitude (average)`,
         LongitudeFrom = `Longitude (average)`)

ct1a <- ct1a %>%
  select(citizenship,
         CountryFrom,
         LatitudeFrom,
         LongitudeFrom,
         yearOfRegistration,
         gender,
         typeOfExploitConcatenated,
         CountryOfExploitation)
```


```{r}

# match the country of exploitation code with country names and coordinates
ct1b <- left_join(ct1a, excountries)


ct1b <- ct1b %>%
  mutate(CountryOfExploitted = Country,
         LatitudeOfExploitation = `Latitude (average)`,
         LongitudeOfExploitation = `Longitude (average)`)

ct1b <- ct1b %>%
  select(citizenship,
         CountryFrom,
         LatitudeFrom,
         LongitudeFrom,
         yearOfRegistration,
         gender,
         typeOfExploitConcatenated,
         CountryOfExploitation,
         CountryOfExploitted,
         LatitudeOfExploitation,
         LongitudeOfExploitation
         )
```



