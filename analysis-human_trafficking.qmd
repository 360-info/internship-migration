---
title: "analysis - human trafficking"
author: "Ruimin Lin - 28757599"
code-fold: true
theme: style/article.scss
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(naniar)
library(gganimate)
```

```{r}
ct <- read_csv("data/The Global Dataset 14 Apr 2020.csv")


ct <- ct %>%
  select(-1) %>% # deselect unused column
  na_if(-99)     # replace all -99 values with NA as defined in the codebook

```

```{r}
ct$typeOfExploitConcatenated[ct$typeOfExploitConcatenated ==
                               "Forced labour;Sexual exploitation;Combined sexual and labour exploitation"] <-"Combined sexual and labour exploitation"

ctp1 <- ct %>%
  drop_na(typeOfExploitConcatenated) %>%
  ggplot(aes(x = typeOfExploitConcatenated, fill = gender)) +
  geom_bar(position = "dodge", width = .7) +
  theme(axis.text.x = element_text(angle=15)) +
  theme_bw() +
  coord_flip()

ctp1

# `Forced labour;Other` & NA not required?
```

```{r}
ctp1 +
  facet_wrap(~majorityStatus)
# should we include NA?
```

```{r}
#ctcountries stands for citizenship countries
ctcountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
  mutate(citizenship = `Alpha-2 code`)

#excountries stands for countries the victim are exploitted to 
excountries <- read_csv("data/countries_codes_and_coordinates.csv") %>%
  mutate(CountryOfExploitation = `Alpha-2 code`)
```

```{r}
# match the citizenship country code with country names and coordinates
ct1 <- ct %>%
  select(yearOfRegistration,
         gender,
         citizenship,
         typeOfExploitConcatenated,
         CountryOfExploitation) %>%
  drop_na(CountryOfExploitation)
ct1

ct1a <- merge(ctcountries,ct1, by="citizenship",all = TRUE)

ct1a <- ct1a %>%
  mutate(CountryFrom = Country,
         LatitudeFrom = `Latitude (average)`,
         LongitudeFrom = `Longitude (average)`)

ct1a <- ct1a %>%
  select(citizenship,
         CountryFrom,
         LatitudeFrom,
         LongitudeFrom,
         yearOfRegistration,
         gender,
         typeOfExploitConcatenated,
         CountryOfExploitation)
```

```{r}

# match the country of exploitation code with country names and coordinates
ct1b <- merge(excountries,ct1a, by="CountryOfExploitation", all = TRUE)

ct1b <- ct1b %>%
  mutate(CountryOfExploitted = Country,
         LatitudeOfExploitation = `Latitude (average)`,
         LongitudeOfExploitation = `Longitude (average)`)

ct1b <- ct1b %>%
  select(citizenship,
         CountryFrom,
         LatitudeFrom,
         LongitudeFrom,
         yearOfRegistration,
         gender,
         typeOfExploitConcatenated,
         CountryOfExploitation,
         CountryOfExploitted,
         LatitudeOfExploitation,
         LongitudeOfExploitation
         )
```
